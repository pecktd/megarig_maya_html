<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>megarig_maya.utils &mdash; megarig_maya  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            megarig_maya
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">megarig_maya</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">megarig_maya.utils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for megarig_maya.utils</h1><div class="highlight"><pre>
<span></span><span class="c1"># Python modules</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># Maya modules</span>
<span class="kn">import</span> <span class="nn">maya.OpenMaya</span> <span class="k">as</span> <span class="nn">om</span>
<span class="kn">import</span> <span class="nn">maya.cmds</span> <span class="k">as</span> <span class="nn">mc</span>

<span class="c1"># megarig modules</span>
<span class="kn">from</span> <span class="nn">megarig_maya</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">mrc</span>
<span class="kn">from</span> <span class="nn">megarig_maya</span> <span class="kn">import</span> <span class="n">naming_tools</span> <span class="k">as</span> <span class="n">mrnt</span>


<span class="c1"># Max/Min values to be used on translation.</span>
<span class="n">MAX_T</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">MIN_T</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>


<div class="viewcode-block" id="connect_trs"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.connect_trs">[docs]</a><span class="k">def</span> <span class="nf">connect_trs</span><span class="p">(</span><span class="n">dag_a</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">dag_b</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Connects translate, rotate and scale attributes from the given</span>
<span class="sd">    daga to dagb.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">):</span>
        <span class="n">dag_a</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">dag_b</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span></div>


<div class="viewcode-block" id="mvec_to_tuple"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.mvec_to_tuple">[docs]</a><span class="k">def</span> <span class="nf">mvec_to_tuple</span><span class="p">(</span><span class="n">mvec</span><span class="p">:</span> <span class="n">om</span><span class="o">.</span><span class="n">MVector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts MVector to tuple.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">mvec</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mvec</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">mvec</span><span class="o">.</span><span class="n">z</span><span class="p">)</span></div>


<div class="viewcode-block" id="meuler_rotation_to_tuple"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.meuler_rotation_to_tuple">[docs]</a><span class="k">def</span> <span class="nf">meuler_rotation_to_tuple</span><span class="p">(</span>
    <span class="n">eul</span><span class="p">:</span> <span class="n">om</span><span class="o">.</span><span class="n">MEulerRotation</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts MEulerRotation to a tuple of three floats.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">eul</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">eul</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">eul</span><span class="o">.</span><span class="n">z</span><span class="p">))</span></div>


<div class="viewcode-block" id="distance"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.distance">[docs]</a><span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">dag1</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">dag2</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the distance between the given DAG nodes.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">om</span><span class="o">.</span><span class="n">MVector</span><span class="p">(</span>
        <span class="n">om</span><span class="o">.</span><span class="n">MVector</span><span class="p">(</span><span class="o">*</span><span class="n">dag2</span><span class="o">.</span><span class="n">world_pos</span><span class="p">)</span> <span class="o">-</span> <span class="n">om</span><span class="o">.</span><span class="n">MVector</span><span class="p">(</span><span class="o">*</span><span class="n">dag1</span><span class="o">.</span><span class="n">world_pos</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_length"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_length">[docs]</a><span class="k">def</span> <span class="nf">get_length</span><span class="p">(</span><span class="n">dags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the sum of the lengthes of the given DAG nodes.&quot;&quot;&quot;</span>
    <span class="nb">len</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">dag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dags</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="nb">len</span> <span class="o">+=</span> <span class="n">om</span><span class="o">.</span><span class="n">MVector</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">world_vec</span> <span class="o">-</span> <span class="n">dags</span><span class="p">[</span><span class="n">ix</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">world_vec</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>

    <span class="k">return</span> <span class="nb">len</span></div>


<div class="viewcode-block" id="create_vector_node"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.create_vector_node">[docs]</a><span class="k">def</span> <span class="nf">create_vector_node</span><span class="p">(</span>
    <span class="n">in1</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="n">in2</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a normalized vector from in1 to in2</span>

<span class="sd">    Returns:</span>
<span class="sd">        mrc.Node: A plusMinusAverage node.</span>
<span class="sd">        mrc.Node: A vectorProduct node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sub</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;plusMinusAverage&quot;</span><span class="p">)</span>
    <span class="n">sub</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;op&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Op</span><span class="o">.</span><span class="n">subtract</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;vectorProduct&quot;</span><span class="p">)</span>
    <span class="n">norm</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;op&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Op</span><span class="o">.</span><span class="n">no</span>
    <span class="n">norm</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;no&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">in2</span> <span class="o">&gt;&gt;</span> <span class="n">sub</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;i3[0]&quot;</span><span class="p">)</span>
    <span class="n">in1</span> <span class="o">&gt;&gt;</span> <span class="n">sub</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;i3[1]&quot;</span><span class="p">)</span>
    <span class="n">sub</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;o3&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">norm</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;i1&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sub</span><span class="p">,</span> <span class="n">norm</span></div>


<div class="viewcode-block" id="selected_edges_to_eyelid_curve"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.selected_edges_to_eyelid_curve">[docs]</a><span class="k">def</span> <span class="nf">selected_edges_to_eyelid_curve</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts selected poly edges to an eyelid curve.&quot;&quot;&quot;</span>
    <span class="n">crv</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">polyToCurve</span><span class="p">(</span><span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">crvshape</span> <span class="o">=</span> <span class="n">crv</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span>
    <span class="n">crvspans</span> <span class="o">=</span> <span class="n">crvshape</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;spans&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span>

    <span class="n">cv0pos</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.cv[0]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">crv</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cvlastpos</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.cv[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">crv</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">crvspans</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cv0pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cvlastpos</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">reverseCurve</span><span class="p">(</span><span class="n">crv</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Side</span><span class="o">.</span><span class="n">left</span>
        <span class="k">if</span> <span class="n">cv0pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Side</span><span class="o">.</span><span class="n">right</span>

        <span class="n">crv</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">mrnt</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="s2">&quot;TmpCrv&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">crv</span></div>


<div class="viewcode-block" id="remove_connected_constraints"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.remove_connected_constraints">[docs]</a><span class="k">def</span> <span class="nf">remove_connected_constraints</span><span class="p">(</span><span class="n">dag</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes all constraint nodes connected to the given dag.&quot;&quot;&quot;</span>
    <span class="n">mc</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">listConnections</span><span class="p">(</span><span class="n">dag</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;constraint&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="curve_guide"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.curve_guide">[docs]</a><span class="k">def</span> <span class="nf">curve_guide</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a NURBs curve guide from the root_dag to the end_dag.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_rename_handle_shape</span><span class="p">(</span><span class="n">handle</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">):</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">listRelatives</span><span class="p">(</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;clusterHandle&quot;</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">ClusterHandleShape&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="n">curve</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">curve</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]))</span>

    <span class="n">root_clust</span><span class="p">,</span> <span class="n">root_clust_handle</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.cv[0]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">wn</span><span class="o">=</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">root</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">_rename_handle_shape</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="n">end_clust</span><span class="p">,</span> <span class="n">end_clust_handle</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.cv[1]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">wn</span><span class="o">=</span><span class="p">(</span><span class="n">end</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">end</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">_rename_handle_shape</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

    <span class="n">curve</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;overrideEnabled&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">curve</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;overrideDisplayType&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">curve</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inheritsTransform&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">curve</span><span class="p">,</span> <span class="n">root_clust</span><span class="p">,</span> <span class="n">root_clust_handle</span><span class="p">,</span> <span class="n">end_clust</span><span class="p">,</span> <span class="n">end_clust_handle</span></div>


<div class="viewcode-block" id="orient_bone"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.orient_bone">[docs]</a><span class="k">def</span> <span class="nf">orient_bone</span><span class="p">(</span><span class="n">jnt</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">up_axis</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">up_vec</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aims Y axis of the given joint to the first child node.&quot;&quot;&quot;</span>
    <span class="n">parnode</span> <span class="o">=</span> <span class="n">jnt</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span>
    <span class="n">chdjnts</span> <span class="o">=</span> <span class="n">jnt</span><span class="o">.</span><span class="n">get_all_children</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_reset_ori</span><span class="p">(</span><span class="n">jnt</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">):</span>
        <span class="n">jnt</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">jnt</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;jo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">chdjnts</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chdjnt</span> <span class="ow">in</span> <span class="n">chdjnts</span><span class="p">:</span>
            <span class="c1"># Parent all child joints to world.</span>
            <span class="n">chdjnt</span><span class="o">.</span><span class="n">set_parent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">jnt</span><span class="o">.</span><span class="n">set_parent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">aim</span><span class="p">(</span><span class="n">jnt</span><span class="p">,</span> <span class="n">chdjnts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">up_axis</span><span class="p">,</span> <span class="n">up_vec</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">chdjnt</span> <span class="ow">in</span> <span class="n">chdjnts</span><span class="p">:</span>
            <span class="c1"># Reparent all child joints.</span>
            <span class="n">chdjnt</span><span class="o">.</span><span class="n">set_parent</span><span class="p">(</span><span class="n">jnt</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">chdjnt</span><span class="o">.</span><span class="n">m_object</span><span class="o">.</span><span class="n">apiType</span><span class="p">()</span> <span class="o">!=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFn</span><span class="o">.</span><span class="n">kJoint</span><span class="p">:</span>
                <span class="c1"># Skip if current node is not joint.</span>
                <span class="k">continue</span>

            <span class="c1"># If current child joint doesn&#39;t have grandchild joints,</span>
            <span class="c1"># reset its orientation.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">chdjnt</span><span class="o">.</span><span class="n">get_child</span><span class="p">():</span>
                <span class="n">_reset_ori</span><span class="p">(</span><span class="n">chdjnt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_reset_ori</span><span class="p">(</span><span class="n">jnt</span><span class="p">)</span>

    <span class="n">jnt</span><span class="o">.</span><span class="n">set_parent</span><span class="p">(</span><span class="n">parnode</span><span class="p">)</span>
    <span class="n">mc</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">jnt</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_rotation_quaternion"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_rotation_quaternion">[docs]</a><span class="k">def</span> <span class="nf">get_rotation_quaternion</span><span class="p">(</span><span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">om</span><span class="o">.</span><span class="n">MQuaternion</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the quaternion rotation from the given dag.&quot;&quot;&quot;</span>
    <span class="n">xformfn</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFnTransform</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">m_dag_path</span><span class="p">)</span>

    <span class="n">utilx</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MScriptUtil</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ptrx</span> <span class="o">=</span> <span class="n">utilx</span><span class="o">.</span><span class="n">asDoublePtr</span><span class="p">()</span>

    <span class="n">utily</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MScriptUtil</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ptry</span> <span class="o">=</span> <span class="n">utily</span><span class="o">.</span><span class="n">asDoublePtr</span><span class="p">()</span>

    <span class="n">utilz</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MScriptUtil</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ptrz</span> <span class="o">=</span> <span class="n">utilz</span><span class="o">.</span><span class="n">asDoublePtr</span><span class="p">()</span>

    <span class="n">utilw</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MScriptUtil</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ptrw</span> <span class="o">=</span> <span class="n">utilw</span><span class="o">.</span><span class="n">asDoublePtr</span><span class="p">()</span>

    <span class="n">xformfn</span><span class="o">.</span><span class="n">getRotationQuaternion</span><span class="p">(</span><span class="n">ptrx</span><span class="p">,</span> <span class="n">ptry</span><span class="p">,</span> <span class="n">ptrz</span><span class="p">,</span> <span class="n">ptrw</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">MSpace</span><span class="o">.</span><span class="n">kWorld</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">om</span><span class="o">.</span><span class="n">MQuaternion</span><span class="p">(</span>
        <span class="n">utilx</span><span class="o">.</span><span class="n">getDouble</span><span class="p">(</span><span class="n">ptrx</span><span class="p">),</span>
        <span class="n">utily</span><span class="o">.</span><span class="n">getDouble</span><span class="p">(</span><span class="n">ptry</span><span class="p">),</span>
        <span class="n">utilz</span><span class="o">.</span><span class="n">getDouble</span><span class="p">(</span><span class="n">ptrz</span><span class="p">),</span>
        <span class="n">utilw</span><span class="o">.</span><span class="n">getDouble</span><span class="p">(</span><span class="n">ptrw</span><span class="p">),</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="get_offset_rotate"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_offset_rotate">[docs]</a><span class="k">def</span> <span class="nf">get_offset_rotate</span><span class="p">(</span>
    <span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets offset rotation values from &#39;dag&#39; to &#39;target&#39;&quot;&quot;&quot;</span>
    <span class="n">dagquat</span> <span class="o">=</span> <span class="n">get_rotation_quaternion</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
    <span class="n">dagquat_inv</span> <span class="o">=</span> <span class="n">dagquat</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
    <span class="n">tarquat</span> <span class="o">=</span> <span class="n">get_rotation_quaternion</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="n">ofstquat</span> <span class="o">=</span> <span class="n">tarquat</span> <span class="o">*</span> <span class="n">dagquat_inv</span>
    <span class="n">ofsteul</span> <span class="o">=</span> <span class="n">ofstquat</span><span class="o">.</span><span class="n">asEulerRotation</span><span class="p">()</span>
    <span class="n">ofsteul</span><span class="o">.</span><span class="n">reorderIt</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;rotateOrder&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ofsteul</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ofsteul</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ofsteul</span><span class="o">.</span><span class="n">z</span><span class="p">]]</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="add_vector_attr"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.add_vector_attr">[docs]</a><span class="k">def</span> <span class="nf">add_vector_attr</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">attr_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds a vector attribute with the given attr_prefix to the given node.&quot;&quot;&quot;</span>
    <span class="n">node</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="n">attr_prefix</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="s2">&quot;double3&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">node</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">X&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_prefix</span><span class="p">),</span> <span class="n">at</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">attr_prefix</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">node</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">Y&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_prefix</span><span class="p">),</span> <span class="n">at</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">attr_prefix</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">node</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">Z&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_prefix</span><span class="p">),</span> <span class="n">at</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">attr_prefix</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attr_prefix</span><span class="p">)</span></div>


<div class="viewcode-block" id="mult_by_parent_inverse_mat"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.mult_by_parent_inverse_mat">[docs]</a><span class="k">def</span> <span class="nf">mult_by_parent_inverse_mat</span><span class="p">(</span>
    <span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">driver</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uses multMatrix node to multiply between the driver(A matrix attribute)</span>
<span class="sd">    and the dag&#39;s parentInverseMatrix.</span>
<span class="sd">    decomposeMatrix is also created to get the transformation output.</span>

<span class="sd">    Returns multMatrix and decomposeMatrix nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">multmat</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;multMatrix&quot;</span><span class="p">)</span>
    <span class="n">decomp</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;decomposeMatrix&quot;</span><span class="p">)</span>

    <span class="n">driver</span> <span class="o">&gt;&gt;</span> <span class="n">multmat</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;matrixIn&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;parentInverseMatrix[0]&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">multmat</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;matrixIn&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
    <span class="n">multmat</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;matrixSum&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">decomp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputMatrix&quot;</span><span class="p">)</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;rotateOrder&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">decomp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputRotateOrder&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">decomp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputTranslate&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">decomp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputRotate&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">decomp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputScale&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">multmat</span><span class="p">,</span> <span class="n">decomp</span></div>


<div class="viewcode-block" id="swing_twist_nodes"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.swing_twist_nodes">[docs]</a><span class="k">def</span> <span class="nf">swing_twist_nodes</span><span class="p">(</span>
    <span class="n">axis</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds swing/twist node connections.</span>

<span class="sd">    Returns eulerToQuat, quatToEuler(twist), quatToEuler(swing), quatInvert</span>
<span class="sd">    and quatProd nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e2q</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;eulerToQuat&quot;</span><span class="p">)</span>
    <span class="n">q2e_tw</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;quatToEuler&quot;</span><span class="p">)</span>
    <span class="n">q2e_sw</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;quatToEuler&quot;</span><span class="p">)</span>
    <span class="n">quat_inv</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;quatInvert&quot;</span><span class="p">)</span>
    <span class="n">quat_prod</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;quatProd&quot;</span><span class="p">)</span>

    <span class="n">in_quat</span> <span class="o">=</span> <span class="s2">&quot;inputQuat</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">out_quat</span> <span class="o">=</span> <span class="s2">&quot;outputQuat</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="c1"># Twist</span>
    <span class="n">e2q</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">out_quat</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">q2e_tw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">in_quat</span><span class="p">)</span>
    <span class="n">e2q</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputQuatW&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">q2e_tw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputQuatW&quot;</span><span class="p">)</span>

    <span class="c1"># Swing</span>
    <span class="n">e2q</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">out_quat</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">quat_inv</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">in_quat</span><span class="p">)</span>
    <span class="n">e2q</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputQuatW&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">quat_inv</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputQuatW&quot;</span><span class="p">)</span>
    <span class="n">quat_inv</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputQuat&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">quat_prod</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;input1Quat&quot;</span><span class="p">)</span>
    <span class="n">e2q</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputQuat&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">quat_prod</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;input2Quat&quot;</span><span class="p">)</span>
    <span class="n">quat_prod</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputQuat&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">q2e_sw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputQuat&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">e2q</span><span class="p">,</span> <span class="n">q2e_tw</span><span class="p">,</span> <span class="n">q2e_sw</span><span class="p">,</span> <span class="n">quat_inv</span><span class="p">,</span> <span class="n">quat_prod</span></div>


<div class="viewcode-block" id="add_non_roll_joint"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.add_non_roll_joint">[docs]</a><span class="k">def</span> <span class="nf">add_non_roll_joint</span><span class="p">(</span><span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">mrc</span><span class="o">.</span><span class="n">Joint</span><span class="p">,</span>
    <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span>
    <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span>
    <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span>
    <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span>
    <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span>
    <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span>
    <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds non-roll joint to the given dag and parent the created node</span>
<span class="sd">    to the given parent.</span>
<span class="sd">    The type of created node is defined by the given dag_type.</span>

<span class="sd">    Returns A non-roll joint, pointConstraint, orientConstraint, eulerToQuat,</span>
<span class="sd">    quatToEuler(twist), quatToEuler(swing), quatInvert and quatProd nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nonroll</span> <span class="o">=</span> <span class="n">create_joint_at</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
        <span class="n">nonroll</span><span class="o">.</span><span class="n">set_parent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

    <span class="n">pointcons</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">pntcons</span><span class="p">(</span><span class="n">dag</span><span class="p">,</span> <span class="n">nonroll</span><span class="p">)</span>
    <span class="n">oricons</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">oricons</span><span class="p">(</span><span class="n">dag</span><span class="p">,</span> <span class="n">nonroll</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
        <span class="n">nonroll</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Ro</span><span class="o">.</span><span class="n">yzx</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
        <span class="n">nonroll</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Ro</span><span class="o">.</span><span class="n">xyz</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span>
        <span class="n">nonroll</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Ro</span><span class="o">.</span><span class="n">zxy</span>

    <span class="n">e2q</span><span class="p">,</span> <span class="n">q2etw</span><span class="p">,</span> <span class="n">q2esw</span><span class="p">,</span> <span class="n">quatinv</span><span class="p">,</span> <span class="n">quatprod</span> <span class="o">=</span> <span class="n">swing_twist_nodes</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

    <span class="n">nonroll</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">e2q</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputRotateOrder&quot;</span><span class="p">)</span>
    <span class="n">nonroll</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">q2etw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputRotateOrder&quot;</span><span class="p">)</span>
    <span class="n">nonroll</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">q2esw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputRotateOrder&quot;</span><span class="p">)</span>

    <span class="n">oricons</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;cr&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">e2q</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputRotate&quot;</span><span class="p">)</span>

    <span class="c1"># Twist</span>
    <span class="n">nonroll</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="s2">&quot;twist&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">outrot</span> <span class="o">=</span> <span class="s2">&quot;outputRotate</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">q2etw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">outrot</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">nonroll</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;twist&quot;</span><span class="p">)</span>

    <span class="c1"># Swing</span>
    <span class="n">q2esw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputRotateX&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">nonroll</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;rx&quot;</span><span class="p">)</span>
    <span class="n">q2esw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputRotateY&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">nonroll</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ry&quot;</span><span class="p">)</span>
    <span class="n">q2esw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputRotateZ&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">nonroll</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;rz&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">nonroll</span><span class="p">,</span> <span class="n">pointcons</span><span class="p">,</span> <span class="n">oricons</span><span class="p">,</span> <span class="n">e2q</span><span class="p">,</span> <span class="n">q2etw</span><span class="p">,</span> <span class="n">q2esw</span><span class="p">,</span> <span class="n">quatinv</span><span class="p">,</span> <span class="n">quatprod</span></div>


<div class="viewcode-block" id="extract_swing_twist"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.extract_swing_twist">[docs]</a><span class="k">def</span> <span class="nf">extract_swing_twist</span><span class="p">(</span>
    <span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts swing and twist rotations from the given dag.</span>

<span class="sd">    Returns eulerToQuat, quatToEuler(twist), quatToEuler(swing), quatInvert</span>
<span class="sd">    and quatProd nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="s2">&quot;swing&quot;</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="s2">&quot;double3&quot;</span><span class="p">)</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="s2">&quot;swingX&quot;</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s2">&quot;swing&quot;</span><span class="p">)</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="s2">&quot;swingY&quot;</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s2">&quot;swing&quot;</span><span class="p">)</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="s2">&quot;swingZ&quot;</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s2">&quot;swing&quot;</span><span class="p">)</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="s2">&quot;twist&quot;</span><span class="p">)</span>

    <span class="n">e2q</span><span class="p">,</span> <span class="n">q2etw</span><span class="p">,</span> <span class="n">q2esw</span><span class="p">,</span> <span class="n">quatinv</span><span class="p">,</span> <span class="n">quatprod</span> <span class="o">=</span> <span class="n">swing_twist_nodes</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

    <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">e2q</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputRotate&quot;</span><span class="p">)</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">e2q</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputRotateOrder&quot;</span><span class="p">)</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">q2etw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputRotateOrder&quot;</span><span class="p">)</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ro&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">q2esw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputRotateOrder&quot;</span><span class="p">)</span>

    <span class="c1"># Twist</span>
    <span class="n">outrot</span> <span class="o">=</span> <span class="s2">&quot;outputRotate</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">q2etw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">outrot</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;twist&quot;</span><span class="p">)</span>

    <span class="c1"># Swing</span>
    <span class="n">q2esw</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputRotate&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;swing&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">e2q</span><span class="p">,</span> <span class="n">q2etw</span><span class="p">,</span> <span class="n">q2esw</span><span class="p">,</span> <span class="n">quatinv</span><span class="p">,</span> <span class="n">quatprod</span></div>


<div class="viewcode-block" id="add_divide_attr"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.add_divide_attr">[docs]</a><span class="k">def</span> <span class="nf">add_divide_attr</span><span class="p">(</span><span class="n">ctrl</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">attrname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds divide attribute to be used as a divider in channel box.</span>
<span class="sd">    It starts and ends with &#39;__&#39; and is locked.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attrname</span> <span class="o">=</span> <span class="s2">&quot;__</span><span class="si">{}</span><span class="s2">__&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attrname</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">))</span>
    <span class="n">ctrl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="n">attrname</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ctrl</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attrname</span><span class="p">)</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attrname</span><span class="p">)</span></div>


<div class="viewcode-block" id="add_shape_vis_controller"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.add_shape_vis_controller">[docs]</a><span class="k">def</span> <span class="nf">add_shape_vis_controller</span><span class="p">(</span><span class="n">ctrl</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">attrname</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds the given &#39;attrname&#39; to ctrl.shape to control the visibility of</span>
<span class="sd">    the shape node of the given target, if the given ctrl doesn&#39;t have</span>
<span class="sd">    a shape, adds to itself instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ctrlshape</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ctrlshape</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ctrlshape</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attrname</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="n">ctrlshape</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="n">attrname</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">driver</span> <span class="o">=</span> <span class="n">ctrlshape</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attrname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attrname</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="n">ctrl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="n">attrname</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">driver</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attrname</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">get_shape</span><span class="p">():</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span>

    <span class="n">driver</span> <span class="o">&gt;&gt;</span> <span class="n">target</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="m_matrix_to_tuple"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.m_matrix_to_tuple">[docs]</a><span class="k">def</span> <span class="nf">m_matrix_to_tuple</span><span class="p">(</span><span class="n">mat</span><span class="p">:</span> <span class="n">om</span><span class="o">.</span><span class="n">MMatrix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Translates om.MMatrix to a tuple.</span>
<span class="sd">    Ex.</span>
<span class="sd">        (</span>
<span class="sd">            (1, 0, 0, 0),</span>
<span class="sd">            (0, 1, 0, 0),</span>
<span class="sd">            (0, 0, 1, 0),</span>
<span class="sd">            (0, 0, 0, 1),</span>
<span class="sd">        )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="nb">tuple</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">MScriptUtil</span><span class="o">.</span><span class="n">getDoubleArrayItem</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="rotate_between_two_objects"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.rotate_between_two_objects">[docs]</a><span class="k">def</span> <span class="nf">rotate_between_two_objects</span><span class="p">(</span>
    <span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">start_dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">end_dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets rotation of the given dag to weighted rotate between</span>
<span class="sd">    start_obj and end_obj with the given weight.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_obj_mat</span> <span class="o">=</span> <span class="n">start_dag</span><span class="o">.</span><span class="n">m_dag_path</span><span class="o">.</span><span class="n">inclusiveMatrix</span><span class="p">()</span>
    <span class="n">start_obj_xform_mat</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MTransformationMatrix</span><span class="p">(</span><span class="n">start_obj_mat</span><span class="p">)</span>
    <span class="n">start_obj_quat</span> <span class="o">=</span> <span class="n">start_obj_xform_mat</span><span class="o">.</span><span class="n">rotation</span><span class="p">()</span>

    <span class="n">end_obj_mat</span> <span class="o">=</span> <span class="n">end_dag</span><span class="o">.</span><span class="n">m_dag_path</span><span class="o">.</span><span class="n">inclusiveMatrix</span><span class="p">()</span>
    <span class="n">end_obj_xform_mat</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MTransformationMatrix</span><span class="p">(</span><span class="n">end_obj_mat</span><span class="p">)</span>
    <span class="n">end_obj_quat</span> <span class="o">=</span> <span class="n">end_obj_xform_mat</span><span class="o">.</span><span class="n">rotation</span><span class="p">()</span>

    <span class="n">halfway_quat</span> <span class="o">=</span> <span class="n">slerp</span><span class="p">(</span><span class="n">start_obj_quat</span><span class="p">,</span> <span class="n">end_obj_quat</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>

    <span class="n">xformfn</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFnTransform</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">m_dag_path</span><span class="p">)</span>
    <span class="n">eulerrot</span> <span class="o">=</span> <span class="n">halfway_quat</span><span class="o">.</span><span class="n">asEulerRotation</span><span class="p">()</span>
    <span class="n">eulerrot</span><span class="o">.</span><span class="n">reorderIt</span><span class="p">(</span><span class="n">xformfn</span><span class="o">.</span><span class="n">rotationOrder</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">degrees</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="p">[</span><span class="n">eulerrot</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">eulerrot</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">eulerrot</span><span class="o">.</span><span class="n">z</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="n">dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">degrees</span></div>


<div class="viewcode-block" id="slerp"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.slerp">[docs]</a><span class="k">def</span> <span class="nf">slerp</span><span class="p">(</span>
    <span class="n">quat_a</span><span class="p">:</span> <span class="n">om</span><span class="o">.</span><span class="n">MQuaternion</span><span class="p">,</span> <span class="n">quat_b</span><span class="p">:</span> <span class="n">om</span><span class="o">.</span><span class="n">MQuaternion</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">om</span><span class="o">.</span><span class="n">MQuaternion</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds slerp between the given quat_a and quat_b with the given weight.</span>
<span class="sd">    The original code is from</span>
<span class="sd">    https://github.com/chadmv/cmt/blob/master/scripts/cmt/rig/swingtwist.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MQuaternion</span><span class="p">()</span>

    <span class="c1"># Calculate angle between them.</span>
    <span class="n">cos_half_theta</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">quat_a</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">w</span>
        <span class="o">+</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">x</span>
        <span class="o">+</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">y</span>
        <span class="o">+</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">z</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cos_half_theta</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">w</span>
        <span class="n">result</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">x</span>
        <span class="n">result</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">y</span>
        <span class="n">result</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">z</span>
        <span class="k">return</span> <span class="n">quat_a</span>

    <span class="c1"># Calculate temporary values</span>
    <span class="n">half_theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">cos_half_theta</span><span class="p">)</span>
    <span class="n">sin_half_theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">cos_half_theta</span> <span class="o">*</span> <span class="n">cos_half_theta</span><span class="p">)</span>
    <span class="c1"># if theta = 180 degrees then result is not fully defined</span>
    <span class="c1"># we could rotate around any axis normal to quat_a or quat_b</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">sin_half_theta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">result</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">result</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">result</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">ratio_a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">weight</span><span class="p">)</span> <span class="o">*</span> <span class="n">half_theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sin_half_theta</span>
    <span class="n">ratio_b</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">weight</span> <span class="o">*</span> <span class="n">half_theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sin_half_theta</span>

    <span class="c1"># Calculate quaternion</span>
    <span class="n">result</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">ratio_a</span> <span class="o">+</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">ratio_b</span>
    <span class="n">result</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">ratio_a</span> <span class="o">+</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">ratio_b</span>
    <span class="n">result</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">ratio_a</span> <span class="o">+</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">ratio_b</span>
    <span class="n">result</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">quat_a</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">ratio_a</span> <span class="o">+</span> <span class="n">quat_b</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">ratio_b</span>

    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="add_space_blender"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.add_space_blender">[docs]</a><span class="k">def</span> <span class="nf">add_space_blender</span><span class="p">(</span>
    <span class="n">target_nodes_and_attr_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
    <span class="n">cons_func</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">pntcons</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">oricons</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">parcons</span><span class="p">],</span>
    <span class="n">constrained_node</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span>
    <span class="n">controller</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds space blender with the given cons_func to the constrained_node.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_nodes_and_attr_names (tuple): A tuple of tuples that have</span>
<span class="sd">            first items as target nodes and scond item as attribute names.</span>
<span class="sd">            Ex. ((mrc.Dag(&#39;head_jnt&#39;): &#39;head&#39;), (mrc.Dag(&#39;eye_jnt&#39;): &#39;eye&#39;))</span>
<span class="sd">        cons_func (mrc.oricons/mrc.pntcons/mrc.parcons):</span>
<span class="sd">        constrained_node (mrc.Dag): &#39;Local&#39; space is always added as the first</span>
<span class="sd">            space blender.</span>
<span class="sd">            It uses constrained_node&#39;s parent as its space.</span>
<span class="sd">        controller (mrc.Dag): A controller that space attribute is added to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of mrc.Dag, space nodes.</span>
<span class="sd">        list: A list of mrc.Node, condition nodes.</span>
<span class="sd">        list: A list of str, attribute names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Defines attribute prefix.</span>
    <span class="n">attr_prefix</span> <span class="o">=</span> <span class="s2">&quot;pointTo&quot;</span>
    <span class="k">if</span> <span class="n">cons_func</span> <span class="o">==</span> <span class="n">mrc</span><span class="o">.</span><span class="n">oricons</span><span class="p">:</span>
        <span class="n">attr_prefix</span> <span class="o">=</span> <span class="s2">&quot;orientTo&quot;</span>
    <span class="k">elif</span> <span class="n">cons_func</span> <span class="o">==</span> <span class="n">mrc</span><span class="o">.</span><span class="n">parcons</span><span class="p">:</span>
        <span class="n">attr_prefix</span> <span class="o">=</span> <span class="s2">&quot;parentTo&quot;</span>

    <span class="c1"># Collects all target nodes.</span>
    <span class="c1"># The local space is added as the first space.</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">constrained_node</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span>

    <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">target_nodes_and_attr_names</span><span class="p">]</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;local&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">target_nodes_and_attr_names</span><span class="p">]</span>

    <span class="c1"># Adds enum attribute.</span>
    <span class="n">controller</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="o">=</span><span class="n">attr_prefix</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="s2">&quot;enum&quot;</span><span class="p">,</span> <span class="n">en</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attrs</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Creates target nodes.</span>
    <span class="n">space_nodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">tg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
        <span class="n">spc</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Null</span><span class="p">()</span>
        <span class="n">spc</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">attr</span>
        <span class="n">space_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spc</span><span class="p">)</span>

        <span class="n">spc</span><span class="o">.</span><span class="n">snap</span><span class="p">(</span><span class="n">constrained_node</span><span class="p">)</span>
        <span class="n">spc</span><span class="o">.</span><span class="n">set_parent</span><span class="p">(</span><span class="n">tg</span><span class="p">)</span>

    <span class="n">cons</span> <span class="o">=</span> <span class="n">cons_func</span><span class="p">(</span><span class="o">*</span><span class="n">space_nodes</span> <span class="o">+</span> <span class="p">[</span><span class="n">constrained_node</span><span class="p">],</span> <span class="n">mo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">conds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">space_nodes</span><span class="p">)):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;condition&quot;</span><span class="p">)</span>
        <span class="n">conds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span>

        <span class="n">controller</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attr_prefix</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">cond</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;firstTerm&quot;</span><span class="p">)</span>
        <span class="n">cond</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;secondTerm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">ix</span>
        <span class="n">cond</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;colorIfTrueR&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">cond</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;colorIfFalseR&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cond</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outColorR&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">cons</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;w</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ix</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">space_nodes</span><span class="p">,</span> <span class="n">conds</span><span class="p">,</span> <span class="n">attrs</span></div>


<div class="viewcode-block" id="do_positions_match"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.do_positions_match">[docs]</a><span class="k">def</span> <span class="nf">do_positions_match</span><span class="p">(</span><span class="n">dag1</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">dag2</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compares the positions of the given dag1 and dag2.</span>
<span class="sd">    Returns True if the positions match with the given tolerance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dag1pos</span> <span class="o">=</span> <span class="n">dag1</span><span class="o">.</span><span class="n">world_pos</span>
    <span class="n">dag2pos</span> <span class="o">=</span> <span class="n">dag2</span><span class="o">.</span><span class="n">world_pos</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dag2pos</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">dag1pos</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="do_vectors_match"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.do_vectors_match">[docs]</a><span class="k">def</span> <span class="nf">do_vectors_match</span><span class="p">(</span><span class="n">vec1</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">vec2</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compares two vectors of three components.</span>
<span class="sd">    Returns True if all values are match with the given tolerance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vec2</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">vec1</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="get_curve_lentgh"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_curve_lentgh">[docs]</a><span class="k">def</span> <span class="nf">get_curve_lentgh</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">curvedag</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">dag_path_from_dag_str</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">curvedag</span><span class="o">.</span><span class="n">extendToShape</span><span class="p">()</span>
    <span class="n">curvefn</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFnNurbsCurve</span><span class="p">(</span><span class="n">curvedag</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">curvefn</span><span class="o">.</span><span class="n">length</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_param_of_closest_point_on_curve"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_param_of_closest_point_on_curve">[docs]</a><span class="k">def</span> <span class="nf">get_param_of_closest_point_on_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets curve paramter of the given curve that has the closest</span>
<span class="sd">    distant to the given dag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">curvedag</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">dag_path_from_dag_str</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">curvedag</span><span class="o">.</span><span class="n">extendToShape</span><span class="p">()</span>
    <span class="n">curvefn</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFnNurbsCurve</span><span class="p">(</span><span class="n">curvedag</span><span class="p">)</span>

    <span class="n">point</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MPoint</span><span class="p">(</span><span class="o">*</span><span class="n">dag</span><span class="o">.</span><span class="n">world_pos</span><span class="p">)</span>
    <span class="n">paramutil</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MScriptUtil</span><span class="p">()</span>
    <span class="n">paramptr</span> <span class="o">=</span> <span class="n">paramutil</span><span class="o">.</span><span class="n">asDoublePtr</span><span class="p">()</span>

    <span class="n">curvefn</span><span class="o">.</span><span class="n">closestPoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">paramptr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">paramutil</span><span class="o">.</span><span class="n">getDouble</span><span class="p">(</span><span class="n">paramptr</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_param_of_closest_point_on_surface"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_param_of_closest_point_on_surface">[docs]</a><span class="k">def</span> <span class="nf">get_param_of_closest_point_on_surface</span><span class="p">(</span>
    <span class="n">nurb</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets surface paramters of the given nurb that has the closest</span>
<span class="sd">    distant to the given dag.</span>

<span class="sd">    Returns U and V parameters as floats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nurbdag</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">dag_path_from_dag_str</span><span class="p">(</span><span class="n">nurb</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">nurbdag</span><span class="o">.</span><span class="n">extendToShape</span><span class="p">()</span>
    <span class="n">nurbfn</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFnNurbsSurface</span><span class="p">(</span><span class="n">nurbdag</span><span class="p">)</span>

    <span class="n">point</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MPoint</span><span class="p">(</span><span class="o">*</span><span class="n">dag</span><span class="o">.</span><span class="n">world_pos</span><span class="p">)</span>

    <span class="n">closest_point</span> <span class="o">=</span> <span class="n">nurbfn</span><span class="o">.</span><span class="n">closestPoint</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

    <span class="n">uparamutil</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MScriptUtil</span><span class="p">()</span>
    <span class="n">vparamutil</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MScriptUtil</span><span class="p">()</span>

    <span class="n">uptr</span> <span class="o">=</span> <span class="n">uparamutil</span><span class="o">.</span><span class="n">asDoublePtr</span><span class="p">()</span>
    <span class="n">vptr</span> <span class="o">=</span> <span class="n">vparamutil</span><span class="o">.</span><span class="n">asDoublePtr</span><span class="p">()</span>
    <span class="n">nurbfn</span><span class="o">.</span><span class="n">getParamAtPoint</span><span class="p">(</span><span class="n">closest_point</span><span class="p">,</span> <span class="n">uptr</span><span class="p">,</span> <span class="n">vptr</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">uparamutil</span><span class="o">.</span><span class="n">getDouble</span><span class="p">(</span><span class="n">uptr</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">vparamutil</span><span class="o">.</span><span class="n">getDouble</span><span class="p">(</span><span class="n">vptr</span><span class="p">))</span></div>


<div class="viewcode-block" id="get_point_at_surface_param"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_point_at_surface_param">[docs]</a><span class="k">def</span> <span class="nf">get_point_at_surface_param</span><span class="p">(</span>
    <span class="n">nurb</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets world position at the given surface parameters.</span>

<span class="sd">    Returns a tuple of x, y, z values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nurbdag</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">dag_path_from_dag_str</span><span class="p">(</span><span class="n">nurb</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">nurbdag</span><span class="o">.</span><span class="n">extendToShape</span><span class="p">()</span>
    <span class="n">nurbfn</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFnNurbsSurface</span><span class="p">(</span><span class="n">nurbdag</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MPoint</span><span class="p">()</span>
    <span class="n">nurbfn</span><span class="o">.</span><span class="n">getPointAtParam</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">z</span></div>


<div class="viewcode-block" id="get_point_at_curve_param"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_point_at_curve_param">[docs]</a><span class="k">def</span> <span class="nf">get_point_at_curve_param</span><span class="p">(</span>
    <span class="n">curve</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets world position at the given curve parameters.</span>

<span class="sd">    Returns a tuple of x, y, z values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">curvedag</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">dag_path_from_dag_str</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">curvedag</span><span class="o">.</span><span class="n">extendToShape</span><span class="p">()</span>
    <span class="n">curvefn</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFnNurbsCurve</span><span class="p">(</span><span class="n">curvedag</span><span class="p">)</span>

    <span class="n">point</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MPoint</span><span class="p">()</span>
    <span class="n">curvefn</span><span class="o">.</span><span class="n">getPointAtParam</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">MSpace</span><span class="o">.</span><span class="n">kWorld</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">z</span></div>


<div class="viewcode-block" id="get_normal_at_curve_param"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_normal_at_curve_param">[docs]</a><span class="k">def</span> <span class="nf">get_normal_at_curve_param</span><span class="p">(</span>
    <span class="n">curve</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets normal vector at the given curve parameters.&quot;&quot;&quot;</span>
    <span class="n">curvedag</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">dag_path_from_dag_str</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">curvedag</span><span class="o">.</span><span class="n">extendToShape</span><span class="p">()</span>
    <span class="n">curvefn</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFnNurbsCurve</span><span class="p">(</span><span class="n">curvedag</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">curvefn</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">MSpace</span><span class="o">.</span><span class="n">kWorld</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">z</span></div>


<div class="viewcode-block" id="get_tangent_at_curve_param"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_tangent_at_curve_param">[docs]</a><span class="k">def</span> <span class="nf">get_tangent_at_curve_param</span><span class="p">(</span>
    <span class="n">curve</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets tangent vector at the given curve parameters.&quot;&quot;&quot;</span>
    <span class="n">curvedag</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">dag_path_from_dag_str</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">curvedag</span><span class="o">.</span><span class="n">extendToShape</span><span class="p">()</span>
    <span class="n">curvefn</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFnNurbsCurve</span><span class="p">(</span><span class="n">curvedag</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">curvefn</span><span class="o">.</span><span class="n">tangent</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">MSpace</span><span class="o">.</span><span class="n">kWorld</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">z</span></div>


<div class="viewcode-block" id="get_closest_mesh_uv"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_closest_mesh_uv">[docs]</a><span class="k">def</span> <span class="nf">get_closest_mesh_uv</span><span class="p">(</span>
    <span class="n">worldpos</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">geo</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the closest UV coordinates to a given world position</span>
<span class="sd">    on a specified mesh.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">point</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MPoint</span><span class="p">(</span><span class="o">*</span><span class="n">worldpos</span><span class="p">)</span>

    <span class="n">dagpath</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span><span class="o">.</span><span class="n">m_dag_path</span>
    <span class="n">meshfn</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFnMesh</span><span class="p">(</span><span class="n">dagpath</span><span class="p">)</span>
    <span class="n">msutil</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MScriptUtil</span><span class="p">()</span>
    <span class="n">msutil</span><span class="o">.</span><span class="n">createFromDouble</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">uvptr</span> <span class="o">=</span> <span class="n">msutil</span><span class="o">.</span><span class="n">asFloat2Ptr</span><span class="p">()</span>
    <span class="n">meshfn</span><span class="o">.</span><span class="n">getUVAtPoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">uvptr</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">MSpace</span><span class="o">.</span><span class="n">kWorld</span><span class="p">,</span> <span class="s2">&quot;map1&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">msutil</span><span class="o">.</span><span class="n">getFloat2ArrayItem</span><span class="p">(</span><span class="n">uvptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">msutil</span><span class="o">.</span><span class="n">getFloat2ArrayItem</span><span class="p">(</span><span class="n">uvptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span></div>


<div class="viewcode-block" id="create_pos"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.create_pos">[docs]</a><span class="k">def</span> <span class="nf">create_pos</span><span class="p">(</span>
    <span class="n">nurb</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">normal_to</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">u_to</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v_to</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uses fourByFourMatrix, multMatrix and decomposeMatrix nodes to</span>
<span class="sd">    get a rivet likes rig to the given DAG node.</span>

<span class="sd">    Args:</span>
<span class="sd">        nurb (mrc.Dag): A transform node of the NURBs surface.</span>
<span class="sd">        dag (mrc.Dag): As a rivet node.</span>
<span class="sd">        normal_to (int): 0, 1 or 2 as a row of Matrix that normalized normal</span>
<span class="sd">            connects to.</span>
<span class="sd">        u_to (int): 0, 1 or 2 as a row of Matrix that normalized tangent U</span>
<span class="sd">            connects to.</span>
<span class="sd">        v_to (int): 0, 1 or 2 as a row of Matrix that normalized tangent V</span>
<span class="sd">            connects to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        mrc.Node: pointOnSurfaceInfo</span>
<span class="sd">        mrc.Node: fourByFourMatrix</span>
<span class="sd">        mrc.Node: multMatrix</span>
<span class="sd">        mrc.Node: decomposeMatrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">nurb</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span>

    <span class="n">posi</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;pointOnSurfaceInfo&quot;</span><span class="p">)</span>
    <span class="n">fbf</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;fourByFourMatrix&quot;</span><span class="p">)</span>

    <span class="n">shape</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;worldSpace[0]&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputSurface&quot;</span><span class="p">)</span>
    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;positionX&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in30&quot;</span><span class="p">)</span>
    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;positionY&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in31&quot;</span><span class="p">)</span>
    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;positionZ&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in32&quot;</span><span class="p">)</span>

    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;normalizedNormalX&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in</span><span class="si">{}</span><span class="s2">0&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_to</span><span class="p">))</span>
    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;normalizedNormalY&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in</span><span class="si">{}</span><span class="s2">1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_to</span><span class="p">))</span>
    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;normalizedNormalZ&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in</span><span class="si">{}</span><span class="s2">2&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_to</span><span class="p">))</span>

    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;normalizedTangentUX&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in</span><span class="si">{}</span><span class="s2">0&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u_to</span><span class="p">))</span>
    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;normalizedTangentUY&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in</span><span class="si">{}</span><span class="s2">1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u_to</span><span class="p">))</span>
    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;normalizedTangentUZ&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in</span><span class="si">{}</span><span class="s2">2&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u_to</span><span class="p">))</span>

    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;normalizedTangentVX&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in</span><span class="si">{}</span><span class="s2">0&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v_to</span><span class="p">))</span>
    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;normalizedTangentVY&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in</span><span class="si">{}</span><span class="s2">1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v_to</span><span class="p">))</span>
    <span class="n">posi</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;normalizedTangentVZ&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;in</span><span class="si">{}</span><span class="s2">2&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v_to</span><span class="p">))</span>

    <span class="n">multmat</span><span class="p">,</span> <span class="n">decomp</span> <span class="o">=</span> <span class="n">mult_by_parent_inverse_mat</span><span class="p">(</span>
        <span class="n">dag</span><span class="p">,</span> <span class="n">fbf</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">posi</span><span class="p">,</span> <span class="n">fbf</span><span class="p">,</span> <span class="n">multmat</span><span class="p">,</span> <span class="n">decomp</span></div>


<div class="viewcode-block" id="aim"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.aim">[docs]</a><span class="k">def</span> <span class="nf">aim</span><span class="p">(</span>
    <span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span>
    <span class="n">dag_aim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">dag_up</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">up_vec</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Orients dag_aim axis of dag to target node and aligns dag_up axis</span>
<span class="sd">    to up_vec.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mc</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
        <span class="n">mrc</span><span class="o">.</span><span class="n">aim_constraint</span><span class="p">(</span>
            <span class="n">target</span><span class="p">,</span> <span class="n">dag</span><span class="p">,</span> <span class="n">aim</span><span class="o">=</span><span class="n">dag_aim</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">dag_up</span><span class="p">,</span> <span class="n">wu</span><span class="o">=</span><span class="n">up_vec</span><span class="p">,</span> <span class="n">wut</span><span class="o">=</span><span class="s2">&quot;vector&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="add_two_ways_clamp"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.add_two_ways_clamp">[docs]</a><span class="k">def</span> <span class="nf">add_two_ways_clamp</span><span class="p">(</span>
    <span class="n">driver</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="n">minr</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">maxr</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">ming</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">maxg</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clamps the driver, using min/max values, to two channels.&quot;&quot;&quot;</span>
    <span class="n">clamp</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;clamp&quot;</span><span class="p">)</span>
    <span class="n">clamp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;mnr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">minr</span>
    <span class="n">clamp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;mxr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">maxr</span>
    <span class="n">clamp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;mng&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">ming</span>
    <span class="n">clamp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;mxg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">maxg</span>

    <span class="n">driver</span> <span class="o">&gt;&gt;</span> <span class="n">clamp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ipr&quot;</span><span class="p">)</span>
    <span class="n">driver</span> <span class="o">&gt;&gt;</span> <span class="n">clamp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;ipg&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">clamp</span></div>


<div class="viewcode-block" id="attr_clamper"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.attr_clamper">[docs]</a><span class="k">def</span> <span class="nf">attr_clamper</span><span class="p">(</span>
    <span class="n">driver</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span>
    <span class="n">driven</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">min_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds a clamp node to clamp value of the driver regarding the given</span>
<span class="sd">    min/max_value.</span>
<span class="sd">    The output from clamp node connects to the driven if it&#39;s given.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">clamper</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;clamp&quot;</span><span class="p">)</span>

    <span class="n">clamper</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;minR&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">min_value</span>
    <span class="n">clamper</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;maxR&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">max_value</span>

    <span class="n">driver</span> <span class="o">&gt;&gt;</span> <span class="n">clamper</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inputR&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">driven</span><span class="p">:</span>
        <span class="n">clamper</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outputR&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">driven</span>

    <span class="k">return</span> <span class="n">clamper</span></div>


<div class="viewcode-block" id="attr_amper"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.attr_amper">[docs]</a><span class="k">def</span> <span class="nf">attr_amper</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="n">driven</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="n">dv</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds an attribute amplifier to the driver that drives</span>
<span class="sd">    the driven attribute. If the driver node has shape the amp_attr is added</span>
<span class="sd">    to its shape else is added to the driver node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mult</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;multDoubleLinear&quot;</span><span class="p">)</span>
    <span class="n">driver</span> <span class="o">&gt;&gt;</span> <span class="n">mult</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;i1&quot;</span><span class="p">)</span>
    <span class="n">mult</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;i2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">dv</span>
    <span class="n">mult</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">driven</span>

    <span class="k">return</span> <span class="n">mult</span></div>


<div class="viewcode-block" id="attr_adder"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.attr_adder">[docs]</a><span class="k">def</span> <span class="nf">attr_adder</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="n">driven</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="n">dv</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds an attribute that uses current driven attribute value</span>
<span class="sd">    as a default value.&quot;&quot;&quot;</span>
    <span class="n">add</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;addDoubleLinear&quot;</span><span class="p">)</span>
    <span class="n">driver</span> <span class="o">&gt;&gt;</span> <span class="n">add</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;i1&quot;</span><span class="p">)</span>
    <span class="n">add</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;i2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">dv</span>
    <span class="n">add</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">driven</span>

    <span class="k">return</span> <span class="n">add</span></div>


<div class="viewcode-block" id="attr_adder_amper"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.attr_adder_amper">[docs]</a><span class="k">def</span> <span class="nf">attr_adder_amper</span><span class="p">(</span>
    <span class="n">driver</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="n">driven</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="n">mult</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds attribute adder with amper from the driver to the driven.</span>
<span class="sd">    This is normally used in Stretchy FK with Offset Translation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        mrc.Node: addDoubleLinear</span>
<span class="sd">        mrc.Node: multDoubleLinear</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">add</span> <span class="o">=</span> <span class="n">attr_adder</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">driven</span><span class="p">,</span> <span class="n">driven</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="n">attr_amper</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">add</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;i1&quot;</span><span class="p">),</span> <span class="n">mult</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">add</span><span class="p">,</span> <span class="n">amp</span></div>


<div class="viewcode-block" id="create_joint_at"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.create_joint_at">[docs]</a><span class="k">def</span> <span class="nf">create_joint_at</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Component</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Joint</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a joint at the position of the given transform.&quot;&quot;&quot;</span>
    <span class="n">jnt</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Joint</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
        <span class="n">jnt</span><span class="o">.</span><span class="n">snap</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="n">jnt</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
        <span class="n">jnt</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;rotateOrder&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;rotateOrder&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span>
    <span class="k">elif</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Component</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
        <span class="n">jnt</span><span class="o">.</span><span class="n">world_pos</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">world_pos</span>

    <span class="k">return</span> <span class="n">jnt</span></div>


<div class="viewcode-block" id="create_joint_and_its_zero_at"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.create_joint_and_its_zero_at">[docs]</a><span class="k">def</span> <span class="nf">create_joint_and_its_zero_at</span><span class="p">(</span><span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Joint</span><span class="p">,</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a joint and its zero group at the position of</span>
<span class="sd">    the given transform.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">jnt</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Joint</span><span class="p">()</span>
    <span class="n">zr</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">jnt</span><span class="p">)</span>
    <span class="n">zr</span><span class="o">.</span><span class="n">snap</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">jnt</span><span class="p">,</span> <span class="n">zr</span></div>


<div class="viewcode-block" id="add_zero_group"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.add_zero_group">[docs]</a><span class="k">def</span> <span class="nf">add_zero_group</span><span class="p">(</span><span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">:</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span>

    <span class="n">zr</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Null</span><span class="p">()</span>
    <span class="n">zr</span><span class="o">.</span><span class="n">snap</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">set_parent</span><span class="p">(</span><span class="n">zr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
        <span class="n">zr</span><span class="o">.</span><span class="n">set_parent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">zr</span></div>


<div class="viewcode-block" id="dup_and_clean_unused_intermediate_shape"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.dup_and_clean_unused_intermediate_shape">[docs]</a><span class="k">def</span> <span class="nf">dup_and_clean_unused_intermediate_shape</span><span class="p">(</span><span class="n">xform</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">:</span>
    <span class="n">dupped</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">xform</span><span class="p">,</span> <span class="n">rr</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="n">dupped</span><span class="o">.</span><span class="n">get_all_shapes</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">):</span>
        <span class="n">dupped</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">dupped</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span><span class="o">.</span><span class="n">hide</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">shapes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dupped</span>

    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">shape</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;intermediateObject&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span><span class="p">:</span>
            <span class="n">mc</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dupped</span></div>


<div class="viewcode-block" id="tr_blend"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.tr_blend">[docs]</a><span class="k">def</span> <span class="nf">tr_blend</span><span class="p">(</span>
    <span class="n">dag1</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">dag2</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">blended_dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">driver</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds translate and rotate blend using a pairBlend node.&quot;&quot;&quot;</span>
    <span class="n">blend</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;pairBlend&quot;</span><span class="p">)</span>
    <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;rotInterpolation&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">driver</span> <span class="o">&gt;&gt;</span> <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">)</span>
    <span class="n">dag1</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inTranslate1&quot;</span><span class="p">)</span>
    <span class="n">dag1</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inRotate1&quot;</span><span class="p">)</span>
    <span class="n">dag2</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inTranslate2&quot;</span><span class="p">)</span>
    <span class="n">dag2</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;inRotate2&quot;</span><span class="p">)</span>

    <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outTranslate&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">blended_dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
    <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;outRotate&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">blended_dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">blend</span></div>


<div class="viewcode-block" id="s_blend"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.s_blend">[docs]</a><span class="k">def</span> <span class="nf">s_blend</span><span class="p">(</span>
    <span class="n">dag1</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">dag2</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">blended_dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">driver</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds scale blend using a blendColors node.&quot;&quot;&quot;</span>
    <span class="n">blend</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;blendColors&quot;</span><span class="p">)</span>

    <span class="n">driver</span> <span class="o">&gt;&gt;</span> <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;blender&quot;</span><span class="p">)</span>
    <span class="n">dag1</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;color1&quot;</span><span class="p">)</span>
    <span class="n">dag2</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;color2&quot;</span><span class="p">)</span>
    <span class="n">blend</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">blended_dag</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">blend</span></div>


<div class="viewcode-block" id="get_compo_center"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_compo_center">[docs]</a><span class="k">def</span> <span class="nf">get_compo_center</span><span class="p">(</span><span class="n">compoes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Component</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">om</span><span class="o">.</span><span class="n">MVector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds center of the given components.&quot;&quot;&quot;</span>
    <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">compo</span> <span class="ow">in</span> <span class="n">compoes</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">compo</span><span class="o">.</span><span class="n">world_pos</span>
        <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">om</span><span class="o">.</span><span class="n">MVector</span><span class="p">(</span>
        <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">compoes</span><span class="p">),</span>
        <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">compoes</span><span class="p">),</span>
        <span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">compoes</span><span class="p">),</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="get_bounding_box_under"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_bounding_box_under">[docs]</a><span class="k">def</span> <span class="nf">get_bounding_box_under</span><span class="p">(</span>
    <span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">compoes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Component</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets bounding box dimension of the given components</span>
<span class="sd">    under the given dag&#39;s space.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">get_compo_center</span><span class="p">(</span><span class="n">mrc</span><span class="o">.</span><span class="n">to_components</span><span class="p">(</span><span class="n">mrc</span><span class="o">.</span><span class="n">get_all_components</span><span class="p">(</span><span class="n">dag</span><span class="p">)))</span>

    <span class="n">x_vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z_vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">compo</span> <span class="ow">in</span> <span class="n">compoes</span><span class="p">:</span>
        <span class="n">vec</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MVector</span><span class="p">(</span><span class="o">*</span><span class="n">compo</span><span class="o">.</span><span class="n">world_pos</span><span class="p">)</span> <span class="o">-</span> <span class="n">origin</span>
        <span class="n">x_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vec</span> <span class="o">*</span> <span class="n">om</span><span class="o">.</span><span class="n">MVector</span><span class="p">(</span><span class="o">*</span><span class="n">dag</span><span class="o">.</span><span class="n">x_axis</span><span class="p">))</span>
        <span class="n">y_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vec</span> <span class="o">*</span> <span class="n">om</span><span class="o">.</span><span class="n">MVector</span><span class="p">(</span><span class="o">*</span><span class="n">dag</span><span class="o">.</span><span class="n">y_axis</span><span class="p">))</span>
        <span class="n">z_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vec</span> <span class="o">*</span> <span class="n">om</span><span class="o">.</span><span class="n">MVector</span><span class="p">(</span><span class="o">*</span><span class="n">dag</span><span class="o">.</span><span class="n">z_axis</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="nb">min</span><span class="p">(</span><span class="n">x_vals</span><span class="p">),</span>
        <span class="nb">min</span><span class="p">(</span><span class="n">y_vals</span><span class="p">),</span>
        <span class="nb">min</span><span class="p">(</span><span class="n">z_vals</span><span class="p">),</span>
        <span class="nb">max</span><span class="p">(</span><span class="n">x_vals</span><span class="p">),</span>
        <span class="nb">max</span><span class="p">(</span><span class="n">y_vals</span><span class="p">),</span>
        <span class="nb">max</span><span class="p">(</span><span class="n">z_vals</span><span class="p">),</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="auto_width_controller"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.auto_width_controller">[docs]</a><span class="k">def</span> <span class="nf">auto_width_controller</span><span class="p">(</span>
    <span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">,</span> <span class="n">compoes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Component</span><span class="p">],</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scales and moves the given dag object to match with</span>
<span class="sd">    the given compo objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dag_compoes</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">to_components</span><span class="p">(</span><span class="n">mrc</span><span class="o">.</span><span class="n">get_all_components</span><span class="p">(</span><span class="n">dag</span><span class="p">))</span>

    <span class="n">compo_center</span> <span class="o">=</span> <span class="n">get_compo_center</span><span class="p">(</span><span class="n">compoes</span><span class="p">)</span>
    <span class="n">dag_center</span> <span class="o">=</span> <span class="n">get_compo_center</span><span class="p">(</span><span class="n">dag_compoes</span><span class="p">)</span>

    <span class="n">move_vec</span> <span class="o">=</span> <span class="n">compo_center</span> <span class="o">-</span> <span class="n">dag_center</span>
    <span class="n">mc</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
        <span class="n">move_vec</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
        <span class="n">move_vec</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
        <span class="n">move_vec</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
        <span class="n">mrc</span><span class="o">.</span><span class="n">get_all_components</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
        <span class="n">r</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">dag_center</span> <span class="o">=</span> <span class="n">get_compo_center</span><span class="p">(</span><span class="n">dag_compoes</span><span class="p">)</span>

    <span class="n">compo_bb</span> <span class="o">=</span> <span class="n">get_bounding_box_under</span><span class="p">(</span><span class="n">dag</span><span class="p">,</span> <span class="n">compoes</span><span class="p">)</span>
    <span class="n">dag_bb</span> <span class="o">=</span> <span class="n">get_bounding_box_under</span><span class="p">(</span><span class="n">dag</span><span class="p">,</span> <span class="n">dag_compoes</span><span class="p">)</span>

    <span class="n">dag_x</span> <span class="o">=</span> <span class="n">dag_bb</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">dag_bb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dag_z</span> <span class="o">=</span> <span class="n">dag_bb</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">dag_bb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">compo_x</span> <span class="o">=</span> <span class="n">compo_bb</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">compo_bb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">compo_z</span> <span class="o">=</span> <span class="n">compo_bb</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">compo_bb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">x_scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">compo_x</span> <span class="o">/</span> <span class="n">dag_x</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>
    <span class="n">z_scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">compo_z</span> <span class="o">/</span> <span class="n">dag_z</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>

    <span class="n">mc</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
        <span class="n">x_scale</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="n">z_scale</span><span class="p">,</span>
        <span class="n">mrc</span><span class="o">.</span><span class="n">get_all_components</span><span class="p">(</span><span class="n">dag</span><span class="p">),</span>
        <span class="n">pivot</span><span class="o">=</span><span class="p">(</span><span class="n">dag_center</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dag_center</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">dag_center</span><span class="o">.</span><span class="n">z</span><span class="p">),</span>
        <span class="n">r</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="auto_width_selected_controller"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.auto_width_selected_controller">[docs]</a><span class="k">def</span> <span class="nf">auto_width_selected_controller</span><span class="p">(</span><span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select components, a controller then call this function.&quot;&quot;&quot;</span>
    <span class="n">sels</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">sl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fl</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dag</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">(</span><span class="n">sels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">compoes</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">to_components</span><span class="p">(</span><span class="n">sels</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">auto_width_controller</span><span class="p">(</span><span class="n">dag</span><span class="p">,</span> <span class="n">compoes</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span></div>


<div class="viewcode-block" id="connect_shape_vis"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.connect_shape_vis">[docs]</a><span class="k">def</span> <span class="nf">connect_shape_vis</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="n">dag</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Connects the given driver attribute to the shapes of the given dag.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">dag</span><span class="o">.</span><span class="n">get_all_shapes</span><span class="p">():</span>
        <span class="n">olddriver</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_input</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">olddriver</span><span class="p">:</span>
            <span class="n">olddriver</span> <span class="o">//</span> <span class="n">shape</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span>
        <span class="n">driver</span> <span class="o">&gt;&gt;</span> <span class="n">shape</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="connect_shape_vises"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.connect_shape_vises">[docs]</a><span class="k">def</span> <span class="nf">connect_shape_vises</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Attr</span><span class="p">,</span> <span class="n">dags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Connects the given driver attribute to the shapes of the given dags.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">dag</span> <span class="ow">in</span> <span class="n">dags</span><span class="p">:</span>
        <span class="n">connect_shape_vis</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">dag</span><span class="p">)</span></div>


<div class="viewcode-block" id="selected_edge_to_control_shape"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.selected_edge_to_control_shape">[docs]</a><span class="k">def</span> <span class="nf">selected_edge_to_control_shape</span><span class="p">(</span><span class="n">closed_curve</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">cv_amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select edges then a transform node.</span>

<span class="sd">    Script converts selected edges to NURBs curve.</span>
<span class="sd">    If &quot;Closed Curve&quot; is checked, script generates the NURBs circle and matches</span>
<span class="sd">    the created curve with the selected edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dag</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">sl</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">mc</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">dag</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">guide_crv</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">polyToCurve</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">spans</span> <span class="o">=</span> <span class="n">guide_crv</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;spans&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span>
    <span class="n">cv_step</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">spans</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">cv_amount</span><span class="p">)</span>

    <span class="n">pnts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">get_point_at_curve_param</span><span class="p">(</span><span class="n">guide_crv</span><span class="p">,</span> <span class="n">ix</span> <span class="o">*</span> <span class="n">cv_step</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cv_amount</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">closed_curve</span><span class="p">:</span>
        <span class="n">crv</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pnts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pnts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">crv</span> <span class="o">=</span> <span class="n">mrc</span><span class="o">.</span><span class="n">Dag</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">curve</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pnts</span><span class="p">)))</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="n">crv</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span>
    <span class="n">mc</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dag</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">pnt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pnts</span><span class="p">):</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.cv[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">ix</span><span class="p">),</span> <span class="n">t</span><span class="o">=</span><span class="n">pnt</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mc</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">guide_crv</span><span class="p">,</span> <span class="n">crv</span><span class="p">)</span></div>


<div class="viewcode-block" id="selected_edge_to_control_shape_ui"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.selected_edge_to_control_shape_ui">[docs]</a><span class="k">def</span> <span class="nf">selected_edge_to_control_shape_ui</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A UI for selected_edge_to_control_shape&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_button_triggered</span><span class="p">(</span><span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="n">cv_amt</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">intFieldGrp</span><span class="p">(</span><span class="n">cv_amt_ffg</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">checkBox</span><span class="p">(</span><span class="n">cc_cb</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">selected_edge_to_control_shape</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">cv_amt</span><span class="p">)</span>

    <span class="n">ui</span> <span class="o">=</span> <span class="s2">&quot;selected_edges_to_curve&quot;</span>
    <span class="n">win</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_win&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ui</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mc</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">deleteUI</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>

    <span class="n">mc</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;Seclect mesh edges&quot;</span><span class="p">)</span>
    <span class="n">mc</span><span class="o">.</span><span class="n">columnLayout</span><span class="p">(</span><span class="n">adj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cv_amt_ffg</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">intFieldGrp</span><span class="p">(</span>
        <span class="n">nf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="s2">&quot;CV amount:&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cal</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">],</span> <span class="n">cw2</span><span class="o">=</span><span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">140</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">cc_cb</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">checkBox</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Closed Curve&quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mc</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="s2">&quot;Create Curve&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_button_triggered</span><span class="p">),</span> <span class="n">h</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="n">mc</span><span class="o">.</span><span class="n">showWindow</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>
    <span class="n">mc</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">220</span><span class="p">)</span>
    <span class="n">mc</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">115</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_first_connected_skin_cluster"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_first_connected_skin_cluster">[docs]</a><span class="k">def</span> <span class="nf">get_first_connected_skin_cluster</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="n">hists</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">listHistory</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">hists</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">his</span> <span class="ow">in</span> <span class="n">hists</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mc</span><span class="o">.</span><span class="n">nodeType</span><span class="p">(</span><span class="n">his</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;skinCluster&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">his</span></div>


<div class="viewcode-block" id="copy_weight"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.copy_weight">[docs]</a><span class="k">def</span> <span class="nf">copy_weight</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Copy skin weights from first selected object to the rest selected object(s).</span>
<span class="sd">    Select source geometry then target geometries then run script.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sels</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">sl</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">jnts</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">skinCluster</span><span class="p">(</span><span class="n">sels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">sels</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">oskin</span> <span class="o">=</span> <span class="n">get_first_connected_skin_cluster</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">oskin</span><span class="p">:</span>
            <span class="n">mc</span><span class="o">.</span><span class="n">skinCluster</span><span class="p">(</span><span class="n">oskin</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">mc</span><span class="o">.</span><span class="n">skinCluster</span><span class="p">(</span><span class="n">jnts</span><span class="p">,</span> <span class="n">sel</span><span class="p">,</span> <span class="n">tsb</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">mc</span><span class="o">.</span><span class="n">select</span><span class="p">((</span><span class="n">sels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sel</span><span class="p">),</span> <span class="n">r</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">copySkinWeights</span><span class="p">(</span>
            <span class="n">noMirror</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">surfaceAssociation</span><span class="o">=</span><span class="s2">&quot;closestPoint&quot;</span><span class="p">,</span>
            <span class="n">influenceAssociation</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="get_soft_selection_data"><a class="viewcode-back" href="../../megarig_maya.html#megarig_maya.utils.get_soft_selection_data">[docs]</a><span class="k">def</span> <span class="nf">get_soft_selection_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: A list of the components effected by the soft selection.</span>
<span class="sd">        list: A list of the selection weights.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">compos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">sel</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MSelectionList</span><span class="p">()</span>
    <span class="n">softsel</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MRichSelection</span><span class="p">()</span>
    <span class="n">om</span><span class="o">.</span><span class="n">MGlobal</span><span class="o">.</span><span class="n">getRichSelection</span><span class="p">(</span><span class="n">softsel</span><span class="p">)</span>
    <span class="n">softsel</span><span class="o">.</span><span class="n">getSelection</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>

    <span class="n">dagpath</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MDagPath</span><span class="p">()</span>
    <span class="n">compo</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MObject</span><span class="p">()</span>

    <span class="n">seliter</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MItSelectionList</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">MFn</span><span class="o">.</span><span class="n">kMeshVertComponent</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">seliter</span><span class="o">.</span><span class="n">isDone</span><span class="p">():</span>

        <span class="n">seliter</span><span class="o">.</span><span class="n">getDagPath</span><span class="p">(</span><span class="n">dagpath</span><span class="p">,</span> <span class="n">compo</span><span class="p">)</span>
        <span class="n">nodepath</span> <span class="o">=</span> <span class="n">dagpath</span><span class="o">.</span><span class="n">fullPathName</span><span class="p">()</span>
        <span class="n">fncomp</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MFnSingleIndexedComponent</span><span class="p">(</span><span class="n">compo</span><span class="p">)</span>

        <span class="n">get_weight</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">om</span><span class="o">.</span><span class="n">MWeight</span><span class="p">(</span><span class="n">fncomp</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">influence</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">fncomp</span><span class="o">.</span><span class="n">hasWeights</span><span class="p">()</span>
            <span class="k">else</span> <span class="mf">1.0</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fncomp</span><span class="o">.</span><span class="n">elementCount</span><span class="p">()):</span>
            <span class="n">compos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.vtx[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nodepath</span><span class="p">,</span> <span class="n">fncomp</span><span class="o">.</span><span class="n">element</span><span class="p">(</span><span class="n">ix</span><span class="p">)))</span>
            <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_weight</span><span class="p">(</span><span class="n">ix</span><span class="p">))</span>

        <span class="n">seliter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">compos</span><span class="p">,</span> <span class="n">weights</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, peck.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>